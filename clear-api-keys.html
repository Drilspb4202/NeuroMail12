<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–û—á–∏—Å—Ç–∫–∞ API –∫–ª—é—á–µ–π - NeuroMail</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 800px;
            margin: 0 auto;
            padding: 20px;
            background-color: #f5f5f5;
        }
        .container {
            background: white;
            padding: 30px;
            border-radius: 10px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        h1 {
            color: #333;
            text-align: center;
        }
        .status {
            padding: 15px;
            margin: 20px 0;
            border-radius: 5px;
            font-weight: bold;
        }
        .success {
            background-color: #d4edda;
            color: #155724;
            border: 1px solid #c3e6cb;
        }
        .error {
            background-color: #f8d7da;
            color: #721c24;
            border: 1px solid #f5c6cb;
        }
        .info {
            background-color: #d1ecf1;
            color: #0c5460;
            border: 1px solid #bee5eb;
        }
        button {
            background-color: #007bff;
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 5px;
            cursor: pointer;
            font-size: 16px;
            margin: 10px 5px;
        }
        button:hover {
            background-color: #0056b3;
        }
        button.danger {
            background-color: #dc3545;
        }
        button.danger:hover {
            background-color: #c82333;
        }
        .key-list {
            background-color: #f8f9fa;
            padding: 15px;
            border-radius: 5px;
            margin: 15px 0;
            font-family: monospace;
            font-size: 12px;
            max-height: 200px;
            overflow-y: auto;
        }
        .log {
            background-color: #f8f9fa;
            padding: 15px;
            border-radius: 5px;
            margin: 15px 0;
            font-family: monospace;
            font-size: 12px;
            max-height: 300px;
            overflow-y: auto;
            white-space: pre-wrap;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>üîß –û—á–∏—Å—Ç–∫–∞ –∏ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ API –∫–ª—é—á–µ–π</h1>
        
        <div id="status" class="status info">
            –ì–æ—Ç–æ–≤ –∫ –æ—á–∏—Å—Ç–∫–µ API –∫–ª—é—á–µ–π. –ù–∞–∂–º–∏—Ç–µ –∫–Ω–æ–ø–∫—É –Ω–∏–∂–µ –¥–ª—è –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è –æ–ø–µ—Ä–∞—Ü–∏–∏.
        </div>
        
        <div style="text-align: center; margin: 30px 0;">
            <button onclick="clearApiKeys()">üßπ –û—á–∏—Å—Ç–∏—Ç—å API –∫–ª—é—á–∏</button>
            <button onclick="checkCurrentKeys()" style="background-color: #28a745;">üîç –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Ç–µ–∫—É—â–∏–µ –∫–ª—é—á–∏</button>
            <button onclick="forceRefresh()" style="background-color: #ffc107; color: #000;">üîÑ –ü—Ä–∏–Ω—É–¥–∏—Ç–µ–ª—å–Ω–æ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ</button>
        </div>
        
        <div id="currentKeys" style="display: none;">
            <h3>–¢–µ–∫—É—â–∏–µ –∫–ª—é—á–∏ –≤ localStorage:</h3>
            <div id="keysList" class="key-list"></div>
        </div>
        
        <div id="log" class="log" style="display: none;"></div>
        
        <div style="margin-top: 30px; padding: 20px; background-color: #e9ecef; border-radius: 5px;">
            <h3>‚ÑπÔ∏è –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è</h3>
            <p>–≠—Ç–∞ —Å—Ç—Ä–∞–Ω–∏—Ü–∞ –ø–æ–º–æ–∂–µ—Ç –≤–∞–º:</p>
            <ul>
                <li>–û—á–∏—Å—Ç–∏—Ç—å –≤—Å–µ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–Ω—ã–µ API –∫–ª—é—á–∏ –∏–∑ localStorage</li>
                <li>–ü—Ä–∏–Ω—É–¥–∏—Ç–µ–ª—å–Ω–æ –æ–±–Ω–æ–≤–∏—Ç—å —Å–æ—Å—Ç–æ—è–Ω–∏–µ –ø—É–ª–∞ –∫–ª—é—á–µ–π</li>
                <li>–ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Ç–µ–∫—É—â–∏–µ –∫–ª—é—á–∏ –≤ —Å–∏—Å—Ç–µ–º–µ</li>
                <li>–ü—Ä–∏–º–µ–Ω–∏—Ç—å –Ω–æ–≤—ã–µ API –∫–ª—é—á–∏ –∏–∑ –∫–æ–¥–∞</li>
            </ul>
            <p><strong>–í–Ω–∏–º–∞–Ω–∏–µ:</strong> –ü–æ—Å–ª–µ –æ—á–∏—Å—Ç–∫–∏ —Å–∏—Å—Ç–µ–º–∞ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –∑–∞–≥—Ä—É–∑–∏—Ç –Ω–æ–≤—ã–µ –∫–ª—é—á–∏ –∏–∑ –æ–±–Ω–æ–≤–ª–µ–Ω–Ω–æ–≥–æ –∫–æ–¥–∞.</p>
        </div>
    </div>

    <script>
        let logElement = null;
        
        function log(message) {
            console.log(message);
            if (logElement) {
                logElement.textContent += new Date().toLocaleTimeString() + ': ' + message + '\n';
                logElement.scrollTop = logElement.scrollHeight;
            }
        }
        
        function showStatus(message, type = 'info') {
            const statusElement = document.getElementById('status');
            statusElement.textContent = message;
            statusElement.className = `status ${type}`;
        }
        
        function clearApiKeys() {
            logElement = document.getElementById('log');
            logElement.style.display = 'block';
            logElement.textContent = '';
            
            showStatus('–í—ã–ø–æ–ª–Ω—è–µ—Ç—Å—è –æ—á–∏—Å—Ç–∫–∞ API –∫–ª—é—á–µ–π...', 'info');
            log('–ù–∞—á–∏–Ω–∞–µ–º –æ—á–∏—Å—Ç–∫—É API –∫–ª—é—á–µ–π...');
            
            try {
                // –°–ø–∏—Å–æ–∫ –∫–ª—é—á–µ–π –¥–ª—è —É–¥–∞–ª–µ–Ω–∏—è
                const keysToRemove = [
                    'api_key_pool_state',
                    'current_user_key',
                    'mailslurp_api_key',
                    'mailslurp_personal_api_key',
                    'use_personal_api',
                    'api_mode',
                    'api_keys_data',
                    'user_prefix'
                ];
                
                let removedCount = 0;
                
                keysToRemove.forEach(key => {
                    if (localStorage.getItem(key)) {
                        localStorage.removeItem(key);
                        log(`–£–¥–∞–ª–µ–Ω –∫–ª—é—á: ${key}`);
                        removedCount++;
                    } else {
                        log(`–ö–ª—é—á –Ω–µ –Ω–∞–π–¥–µ–Ω: ${key}`);
                    }
                });
                
                // –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–∞—è –æ—á–∏—Å—Ç–∫–∞ - —É–¥–∞–ª—è–µ–º –≤—Å–µ –∫–ª—é—á–∏, —Å–æ–¥–µ—Ä–∂–∞—â–∏–µ 'api' –∏–ª–∏ 'key'
                const allKeys = Object.keys(localStorage);
                allKeys.forEach(key => {
                    if (key.toLowerCase().includes('api') || key.toLowerCase().includes('key')) {
                        if (!keysToRemove.includes(key)) {
                            localStorage.removeItem(key);
                            log(`–£–¥–∞–ª–µ–Ω –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–π –∫–ª—é—á: ${key}`);
                            removedCount++;
                        }
                    }
                });
                
                log(`–û—á–∏—Å—Ç–∫–∞ –∑–∞–≤–µ—Ä—à–µ–Ω–∞. –£–¥–∞–ª–µ–Ω–æ –∫–ª—é—á–µ–π: ${removedCount}`);
                
                // –ü—Ä–∏–Ω—É–¥–∏—Ç–µ–ª—å–Ω–æ –æ–±–Ω–æ–≤–ª—è–µ–º —Å–æ—Å—Ç–æ—è–Ω–∏–µ
                setTimeout(() => {
                    forceRefresh();
                }, 1000);
                
                showStatus(`‚úÖ –û—á–∏—Å—Ç–∫–∞ –∑–∞–≤–µ—Ä—à–µ–Ω–∞! –£–¥–∞–ª–µ–Ω–æ ${removedCount} –∫–ª—é—á–µ–π.`, 'success');
                
            } catch (error) {
                log(`–û—à–∏–±–∫–∞ –ø—Ä–∏ –æ—á–∏—Å—Ç–∫–µ: ${error.message}`);
                showStatus(`‚ùå –û—à–∏–±–∫–∞ –ø—Ä–∏ –æ—á–∏—Å—Ç–∫–µ: ${error.message}`, 'error');
            }
        }
        
        function checkCurrentKeys() {
            logElement = document.getElementById('log');
            logElement.style.display = 'block';
            logElement.textContent = '';
            
            showStatus('–ü—Ä–æ–≤–µ—Ä–∫–∞ —Ç–µ–∫—É—â–∏—Ö –∫–ª—é—á–µ–π...', 'info');
            log('–ü—Ä–æ–≤–µ—Ä—è–µ–º —Ç–µ–∫—É—â–∏–µ –∫–ª—é—á–∏ –≤ localStorage...');
            
            const allKeys = Object.keys(localStorage);
            const apiKeys = allKeys.filter(key => 
                key.toLowerCase().includes('api') || 
                key.toLowerCase().includes('key') ||
                key.toLowerCase().includes('mailslurp')
            );
            
            const keysListElement = document.getElementById('keysList');
            const currentKeysElement = document.getElementById('currentKeys');
            
            if (apiKeys.length > 0) {
                keysListElement.innerHTML = apiKeys.map(key => {
                    const value = localStorage.getItem(key);
                    const displayValue = value.length > 50 ? value.substring(0, 50) + '...' : value;
                    return `${key}: ${displayValue}`;
                }).join('\n');
                currentKeysElement.style.display = 'block';
                log(`–ù–∞–π–¥–µ–Ω–æ ${apiKeys.length} –∫–ª—é—á–µ–π, —Å–≤—è–∑–∞–Ω–Ω—ã—Ö —Å API`);
            } else {
                keysListElement.textContent = 'API –∫–ª—é—á–∏ –Ω–µ –Ω–∞–π–¥–µ–Ω—ã';
                currentKeysElement.style.display = 'block';
                log('API –∫–ª—é—á–∏ –Ω–µ –Ω–∞–π–¥–µ–Ω—ã –≤ localStorage');
            }
            
            showStatus(`üîç –ü—Ä–æ–≤–µ—Ä–∫–∞ –∑–∞–≤–µ—Ä—à–µ–Ω–∞. –ù–∞–π–¥–µ–Ω–æ ${apiKeys.length} –∫–ª—é—á–µ–π.`, 'success');
        }
        
        function forceRefresh() {
            logElement = document.getElementById('log');
            logElement.style.display = 'block';
            logElement.textContent = '';
            
            showStatus('–ü—Ä–∏–Ω—É–¥–∏—Ç–µ–ª—å–Ω–æ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Å–æ—Å—Ç–æ—è–Ω–∏—è...', 'info');
            log('–í—ã–ø–æ–ª–Ω—è–µ–º –ø—Ä–∏–Ω—É–¥–∏—Ç–µ–ª—å–Ω–æ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Å–æ—Å—Ç–æ—è–Ω–∏—è...');
            
            try {
                // –£–¥–∞–ª—è–µ–º –≤—Å–µ —Å–≤—è–∑–∞–Ω–Ω—ã–µ —Å API –∫–ª—é—á–∏
                const keysToRemove = [
                    'api_key_pool_state',
                    'current_user_key',
                    'mailslurp_api_key',
                    'mailslurp_personal_api_key',
                    'use_personal_api',
                    'api_mode',
                    'api_keys_data',
                    'user_prefix'
                ];
                
                keysToRemove.forEach(key => {
                    localStorage.removeItem(key);
                    log(`–£–¥–∞–ª–µ–Ω –∫–ª—é—á: ${key}`);
                });
                
                // –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –Ω–æ–≤—ã–µ –∫–ª—é—á–∏ –∏–∑ –æ–±–Ω–æ–≤–ª–µ–Ω–Ω–æ–≥–æ –∫–æ–¥–∞
                const newApiKeys = [
                    {
                        key: '69c1983367897df2e0f28e68eeab1567312e7b8cb63b32924b13f09b4e5ef959',
                        usageCount: 0,
                        lastUsed: null,
                        isExhausted: false,
                        monthlyReset: new Date().getTime()
                    },
                    {
                        key: '0d71400fe28471738cf0b933ffaa701d9ce7d9e09e07d52c271753c387f8bfcb',
                        usageCount: 0,
                        lastUsed: null,
                        isExhausted: false,
                        monthlyReset: new Date().getTime()
                    },
                    {
                        key: '07da08f927f3c354bddcba093f38ee83f37ee265c7e1000e35a4ef236e5a43cb',
                        usageCount: 0,
                        lastUsed: null,
                        isExhausted: false,
                        monthlyReset: new Date().getTime()
                    }
                ];
                
                // –°–æ—Ö—Ä–∞–Ω—è–µ–º –Ω–æ–≤–æ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ –ø—É–ª–∞ –∫–ª—é—á–µ–π
                const newState = {
                    publicKeys: newApiKeys,
                    currentKeyIndex: 0
                };
                
                localStorage.setItem('api_key_pool_state', JSON.stringify(newState));
                localStorage.setItem('mailslurp_api_key', newApiKeys[0].key);
                localStorage.setItem('api_mode', 'public');
                
                log('–£—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω—ã –Ω–æ–≤—ã–µ API –∫–ª—é—á–∏:');
                newApiKeys.forEach((keyData, index) => {
                    log(`  –ö–ª—é—á ${index + 1}: ${keyData.key.substring(0, 20)}...`);
                });
                
                log('–ü—Ä–∏–Ω—É–¥–∏—Ç–µ–ª—å–Ω–æ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ –∑–∞–≤–µ—Ä—à–µ–Ω–æ —É—Å–ø–µ—à–Ω–æ');
                showStatus('‚úÖ –ü—Ä–∏–Ω—É–¥–∏—Ç–µ–ª—å–Ω–æ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ –∑–∞–≤–µ—Ä—à–µ–Ω–æ! –ù–æ–≤—ã–µ –∫–ª—é—á–∏ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω—ã.', 'success');
                
            } catch (error) {
                log(`–û—à–∏–±–∫–∞ –ø—Ä–∏ –ø—Ä–∏–Ω—É–¥–∏—Ç–µ–ª—å–Ω–æ–º –æ–±–Ω–æ–≤–ª–µ–Ω–∏–∏: ${error.message}`);
                showStatus(`‚ùå –û—à–∏–±–∫–∞ –ø—Ä–∏ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–∏: ${error.message}`, 'error');
            }
        }
        
        // –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞ –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ —Å—Ç—Ä–∞–Ω–∏—Ü—ã
        window.addEventListener('load', () => {
            log('–°—Ç—Ä–∞–Ω–∏—Ü–∞ –æ—á–∏—Å—Ç–∫–∏ API –∫–ª—é—á–µ–π –∑–∞–≥—Ä—É–∂–µ–Ω–∞');
            log('–ì–æ—Ç–æ–≤ –∫ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—é –æ–ø–µ—Ä–∞—Ü–∏–π —Å API –∫–ª—é—á–∞–º–∏');
        });
    </script>
</body>
</html>
